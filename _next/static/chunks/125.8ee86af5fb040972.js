"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[125],{1125:(e,t,n)=>{n.r(t),n.d(t,{default:()=>q});var o=n(5155),r=n(2115),a=n(833),l=n(5402);n(8413);let i={"Research Projects":{value:"Research Projects",label:"Research Projects",color:"#3B82F6",icon:"\uD83D\uDD2C",symbol:"R",glowColor:"rgba(59, 130, 246, 0.8)",description:"Academic research and scholarly projects"},"Art-Based Projects":{value:"Art-Based Projects",label:"Art-Based Projects",color:"#8B5CF6",icon:"\uD83C\uDFA8",symbol:"A",glowColor:"rgba(139, 92, 246, 0.8)",description:"Creative and artistic projects"},"Education and Community Outreach":{value:"Education and Community Outreach",label:"Education and Community Outreach",color:"#10B981",icon:"\uD83E\uDD1D",symbol:"C",glowColor:"rgba(16, 185, 129, 0.8)",description:"Educational and community engagement initiatives"},Research:{value:"Research",label:"Research",color:"#06B6D4",icon:"\uD83D\uDCCA",symbol:"S",glowColor:"rgba(6, 182, 212, 0.8)",description:"General research activities"},Other:{value:"Other",label:"Other",color:"blue",icon:"⭐",symbol:"O",glowColor:"rgb(255, 13, 0)",description:"Project types"}},s=e=>i[e]||i.Other,c=e=>[...new Set(e.map(e=>e.ProjectCategory).filter(Boolean))].map(e=>s(e));var d=n(9388),u=n(3710),p=n(3314),f=n(9380);n(8576),n(4609);var g=n(8741);let h=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=s(e),a=t?60:32,l=t?4:n?3:2,i=t?"0 0 30px":n?"0 0 15px":"0 0 8px",c=(null==o?void 0:o.ImageUrl)||(null==o?void 0:o.imageUrl);return t&&c?(0,g.divIcon)({className:"custom-div-icon category-".concat(e.toLowerCase().replace(/\s+/g,"-")," selected-with-image"),html:'\n        <div style="\n          background: linear-gradient(135deg, '.concat(r.color,", ").concat(r.color,"dd);\n          width: ").concat(a,"px; \n          height: ").concat(a,"px; \n          border-radius: 50%; \n          border: ").concat(l,"px solid white; \n          box-shadow: ").concat(i," ").concat(r.glowColor,', 0 0 40px rgba(0, 255, 136, 0.6);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          position: relative;\n          overflow: hidden;\n          transition: all 0.3s ease;\n        ">\n          <img \n            src="').concat(c,'" \n            alt="').concat((null==o?void 0:o.Name)||"Project",'"\n            style="\n              width: 100%;\n              height: 100%;\n              object-fit: cover;\n              border-radius: 50%;\n            "\n            onError="this.style.display=\'none\'"\n          />\n          <div style="\n            position: absolute;\n            top: -8px;\n            right: -8px;\n            background: #00ff88;\n            color: black;\n            border-radius: 50%;\n            width: 16px;\n            height: 16px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            font-weight: bold;\n            border: 2px solid white;\n            box-shadow: 0 0 10px rgba(0, 255, 136, 0.8);\n            z-index: 10;\n          ">✓</div>\n          <div style="\n            position: absolute;\n            bottom: 2px;\n            right: 2px;\n            background: ').concat(r.color,';\n            color: white;\n            border-radius: 50%;\n            width: 18px;\n            height: 18px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 10px;\n            font-weight: bold;\n            border: 2px solid white;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n          ">').concat(r.icon,"</div>\n        </div>\n      "),iconSize:[a,a],iconAnchor:[a/2,a/2],popupAnchor:[0,-a/2]}):(0,g.divIcon)({className:"custom-div-icon category-".concat(e.toLowerCase().replace(/\s+/g,"-")),html:'\n        <div style="\n          background-color: '.concat(r.color,"; \n          width: ").concat(a,"px; \n          height: ").concat(a,"px; \n          border-radius: 50%; \n          border: ").concat(l,"px solid white; \n          box-shadow: ").concat(i," ").concat(r.glowColor,";\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: ").concat(Math.max(16,.5*a),'px;\n          color: white;\n          font-weight: bold;\n          font-family: Arial, sans-serif;\n          text-shadow: 1px 1px 2px rgba(0,0,0,0.5);\n          transition: all 0.3s ease;\n          position: relative;\n          line-height: 1;\n        ">\n          ').concat(r.icon,"\n          ").concat(t?'\n            <div style="\n              position: absolute;\n              top: -8px;\n              right: -8px;\n              background: #00ff88;\n              color: black;\n              border-radius: 50%;\n              width: 12px;\n              height: 12px;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              font-size: 8px;\n              font-weight: bold;\n              border: 2px solid white;\n              box-shadow: 0 0 10px rgba(0, 255, 136, 0.8);\n            ">✓</div>\n          ':"","\n        </div>\n      "),iconSize:[a,a],iconAnchor:[a/2,a/2],popupAnchor:[0,-a/2]})};n(2127);let x=e=>{let t=e.ImageUrl||e.imageUrl,n=s(e.ProjectCategory||"Other");return'\n    <div style="min-width: 180px; max-width: 240px; padding: 8px;">\n      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">\n        '.concat(t?'\n          <img src="'.concat(t,'" alt="').concat(e.Name,'" style="\n            width: 32px; \n            height: 32px; \n            object-fit: cover; \n            border-radius: 6px; \n            border: 1px solid ').concat(n.color,';\n          " />\n        '):'\n          <div style="\n            width: 32px; \n            height: 32px; \n            background: '.concat(n.color,';\n            border-radius: 6px; \n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 14px;\n            font-weight: bold;\n            color: white;\n          ">\n            ').concat(n.symbol,"\n          </div>\n        "),'\n        <div style="flex: 1;">\n          <h3 style="margin: 0 0 3px 0; color: #333; font-size: 13px; font-weight: 600; line-height: 1.2;">\n            ').concat(e.Name,'\n          </h3>\n          <div style="\n            display: inline-block;\n            background: ').concat(n.color,';\n            color: white;\n            padding: 1px 4px;\n            border-radius: 8px;\n            font-size: 9px;\n            font-weight: 500;\n          ">\n            ').concat(n.label,"\n          </div>\n        </div>\n      </div>\n      \n      ").concat(e.DescriptionShort?'\n        <p style="margin: 0; color: #666; line-height: 1.3; font-size: 11px;">\n          '.concat(e.DescriptionShort.length>60?e.DescriptionShort.substring(0,60)+"...":e.DescriptionShort,"\n        </p>\n      "):"","\n    </div>\n  ")},m=e=>{let{projects:t,onMarkerClick:n,selectedProject:a,markerRefs:l}=e;(0,r.useEffect)(()=>{let e=document.createElement("style");return e.textContent="\n      .custom-cluster-icon {\n        background: transparent !important;\n        border: none !important;\n      }\n      \n      .leaflet-cluster-anim .leaflet-marker-icon, \n      .leaflet-cluster-anim .leaflet-marker-shadow {\n        transition: transform 0.3s ease-out, opacity 0.3s ease-in;\n      }\n      \n      .marker-cluster {\n        background: transparent !important;\n        border: none !important;\n      }\n      \n      .marker-cluster div {\n        background: transparent !important;\n        border: none !important;\n      }\n      \n      .marker-cluster span {\n        display: none !important;\n      }\n\n      /* Enhanced cluster badge highlighting */\n      .cluster-count-badge {\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        position: relative;\n        overflow: visible;\n      }\n\n      .cluster-count-badge.highlighted {\n        transform: scale(1.4) !important;\n        z-index: 1000 !important;\n        box-shadow: \n          0 0 0 4px rgba(59, 130, 246, 0.3),\n          0 0 0 8px rgba(59, 130, 246, 0.2),\n          0 0 20px 4px rgba(59, 130, 246, 0.4),\n          0 8px 25px rgba(0, 0, 0, 0.3) !important;\n        border: 3px solid #fff !important;\n        animation: cluster-highlight-pulse 4s ease-in-out infinite;\n      }\n\n      @keyframes cluster-highlight-pulse {\n        0%, 100% { \n          box-shadow: \n            0 0 0 4px rgba(59, 130, 246, 0.3),\n            0 0 0 8px rgba(59, 130, 246, 0.2),\n            0 0 20px 4px rgba(59, 130, 246, 0.4),\n            0 8px 25px rgba(0, 0, 0, 0.3);\n        }\n        50% { \n          box-shadow: \n            0 0 0 6px rgba(59, 130, 246, 0.4),\n            0 0 0 12px rgba(59, 130, 246, 0.3),\n            0 0 30px 8px rgba(59, 130, 246, 0.6),\n            0 12px 35px rgba(0, 0, 0, 0.4);\n        }\n      }\n\n      /* Cluster book highlighting */\n      .storybook-cluster.highlighted {\n        animation: book-highlight-float 2s ease-in-out infinite;\n        filter: drop-shadow(0 0 15px rgba(59, 130, 246, 0.5));\n      }\n\n      @keyframes book-highlight-float {\n        0%, 100% { \n          transform: translateY(-2px) rotateZ(0deg) scale(1.05);\n          filter: drop-shadow(0 0 15px rgba(59, 130, 246, 0.5));\n        }\n        50% { \n          transform: translateY(-8px) rotateZ(2deg) scale(1.1);\n          filter: drop-shadow(0 0 25px rgba(59, 130, 246, 0.7));\n        }\n      }\n\n      /* Additional ripple effect for highlighted clusters */\n      .cluster-count-badge.highlighted::before {\n        content: '';\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        width: 200%;\n        height: 200%;\n        background: radial-gradient(circle, rgba(59, 130, 246, 0.3) 0%, transparent 70%);\n        border-radius: 50%;\n        transform: translate(-50%, -50%);\n        animation: ripple-effect 1.5s ease-out infinite;\n        pointer-events: none;\n        z-index: -1;\n      }\n\n      @keyframes ripple-effect {\n        0% {\n          width: 100%;\n          height: 100%;\n          opacity: 1;\n        }\n        100% {\n          width: 300%;\n          height: 300%;\n          opacity: 0;\n        }\n      }\n\n      /* Highlight the entire cluster container when badge is highlighted */\n      .storybook-cluster:has(.cluster-count-badge.highlighted),\n      .desert-cluster:has(.cluster-count-badge.highlighted),\n      .border-cluster:has(.cluster-count-badge.highlighted) {\n        animation-duration: 1.5s !important;\n        filter: brightness(1.1) saturate(1.2);\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]);let i=(0,r.useRef)(null);return t&&0!==t.length?(0,o.jsx)(f.A,{chunkedLoading:!0,maxClusterRadius:60,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!0,disableClusteringAtZoom:10,iconCreateFunction:e=>{let t=e.getChildCount(),n=e.getAllChildMarkers(),o=n.map(e=>{var t,n,o,r;return(null===(n=e.options)||void 0===n?void 0:null===(t=n.project)||void 0===t?void 0:t.ProjectCategory)||(null===(r=e.options)||void 0===r?void 0:null===(o=r.projectData)||void 0===o?void 0:o.ProjectCategory)||"Other"}).reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{}),r=Object.keys(o).reduce((e,t)=>o[e]>o[t]?e:t),a="storybook-cluster";r.includes("Environment")||r.includes("Ecology")?a="desert-cluster":r.includes("Borders")||r.includes("Migration")?a="border-cluster":r.includes("Storytelling")&&(a="storybook-cluster");let l=n.map(e=>{var t,n,o,r,a,l,i,s;return(null===(n=e.options)||void 0===n?void 0:null===(t=n.projectData)||void 0===t?void 0:t.Name)||(null===(r=e.options)||void 0===r?void 0:null===(o=r.project)||void 0===o?void 0:o.Name)||(null===(a=e.properties)||void 0===a?void 0:a.projectName)||(null===(l=e.projectData)||void 0===l?void 0:l.Name)||(null===(s=e._icon)||void 0===s?void 0:null===(i=s.projectData)||void 0===i?void 0:i.Name)}).filter(Boolean).join(",");s(r);let i="cluster-".concat(t,"-").concat(r,"-").concat(Math.round(1e3*e.getLatLng().lat),"-").concat(Math.round(1e3*e.getLatLng().lng)),c=(e=>e>=100?{size:60,fontSize:"16px",style:"mega",borderWidth:4}:e>=50?{size:50,fontSize:"14px",style:"large",borderWidth:3}:e>=10?{size:42,fontSize:"13px",style:"medium",borderWidth:3}:{size:36,fontSize:"12px",style:"small",borderWidth:2})(t),d='\n      <style>\n        @keyframes book-float {\n          0%, 100% { transform: translateY(-1px) rotateZ(0deg) scale(1.02); }\n          50% { transform: translateY(-4px) rotateZ(1deg) scale(1.04); }\n        }\n      </style>\n      <div class="'.concat(a,'" \n           id="').concat(i,'"\n           data-project-names="').concat(l,'"\n           data-category="').concat(r,'"\n           data-count="').concat(t,'"\n           style="\n        position: relative;\n        width: ').concat(c.size,"px;\n        height: ").concat(c.size,'px;\n        cursor: pointer;\n        background: #f5e6c8;\n        border-radius: 14px;\n        box-shadow: 0 4px 16px rgba(160,120,60,0.18);\n        border: 2px solid #e0c48a;\n        animation: book-float 3s ease-in-out infinite;\n      ">\n        <div class="cluster-count-badge ').concat(r.toLowerCase(),"-badge cluster-badge-").concat(i,'" \n             id="badge-').concat(i,'"\n             data-cluster-id="').concat(i,'"\n             data-category="').concat(r,'"\n             data-count="').concat(t,'"\n             data-project-names="').concat(l,'"\n             style="\n          position: absolute;\n          top: -18px;\n          left: -18px;\n          border-radius: 50%;\n          width: 32px;\n          height: 32px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 14px;\n          font-weight: bold;\n          border: 3px solid #fffbe6;\n          box-shadow: 0 3px 10px rgba(0,0,0,0.18);\n          z-index: 30;\n          background: #e0c48a;\n          color: #7a5c1e;\n          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n          pointer-events: auto;\n        ">').concat(t,'</div>\n        <div style="\n          position: absolute;\n          left: 50%;\n          bottom: 6px;\n          transform: translateX(-50%);\n          font-size: 20px;\n          z-index: 20;\n        ">\uD83D\uDCD6</div>\n      </div>\n    '),u='\n      <style>\n        @keyframes sun-pulse {\n          0%, 100% { transform: scale(1); opacity: 1; }\n          50% { transform: scale(1.18); opacity: 0.7; }\n        }\n      </style>\n      <div class="'.concat(a,'" \n           id="').concat(i,'"\n           data-project-names="').concat(l,'"\n           data-category="').concat(r,'"\n           data-count="').concat(t,'"\n           style="\n        position: relative;\n        width: ').concat(c.size,"px;\n        height: ").concat(c.size,'px;\n        cursor: pointer;\n        background: #fff7d6;\n        border-radius: 14px;\n        box-shadow: 0 4px 16px rgba(220,180,60,0.18);\n        border: 2px solid #ffe082;\n      ">\n        <div class="cluster-count-badge ').concat(r.toLowerCase(),"-badge cluster-badge-").concat(i,'" \n             id="badge-').concat(i,'"\n             data-cluster-id="').concat(i,'"\n             data-category="').concat(r,'"\n             data-count="').concat(t,'"\n             data-project-names="').concat(l,'"\n             style="\n          position: absolute;\n          top: -18px;\n          left: -18px;\n          border-radius: 50%;\n          width: 32px;\n          height: 32px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 14px;\n          font-weight: bold;\n          border: 3px solid #fffbe6;\n          box-shadow: 0 3px 10px rgba(0,0,0,0.18);\n          z-index: 30;\n          background: #ffe082;\n          color: #a67c1e;\n          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n          pointer-events: auto;\n        ">').concat(t,'</div>\n        <span style="\n          position: absolute;\n          left: 50%;\n          bottom: 2px;\n          transform: translateX(-50%) translateY(40%);\n          font-size: 28px;\n          z-index: 10;\n          animation: sun-pulse 2.8s infinite;\n          pointer-events: none;\n        ">☀️</span>\n        <div style="\n          position: absolute;\n          left: 50%;\n          bottom: 6px;\n          transform: translateX(-50%);\n          font-size: 22px;\n          z-index: 20;\n        ">\uD83C\uDF35</div>\n      </div>\n    '),p='\n      <style>\n        @keyframes person1-walk {\n          0% { left: 70%; opacity: 0; }\n          10% { opacity: 1; }\n          80% { opacity: 1; }\n          100% { left: 0%; opacity: 0; }\n        }\n        @keyframes person2-walk {\n          0% { left: 70%; opacity: 0; }\n          20% { opacity: 0; }\n          30% { opacity: 1; }\n          90% { opacity: 1; }\n          100% { left: 0%; opacity: 0; }\n        }\n      </style>\n      <div class="'.concat(a,'" \n           id="').concat(i,'"\n           data-project-names="').concat(l,'"\n           data-category="').concat(r,'"\n           data-count="').concat(t,'"\n           style="\n        position: relative;\n        width: ').concat(c.size,"px;\n        height: ").concat(c.size,'px;\n        cursor: pointer;\n        background: #fff7d6;\n        border-radius: 14px;\n        box-shadow: 0 4px 16px rgba(220,180,60,0.18);\n        border: 2px solid #ffe082;\n      ">\n        <div class="cluster-count-badge ').concat(r.toLowerCase(),"-badge cluster-badge-").concat(i,'" \n             id="badge-').concat(i,'"\n             data-cluster-id="').concat(i,'"\n             data-category="').concat(r,'"\n             data-count="').concat(t,'"\n             data-project-names="').concat(l,'"\n             style="\n          position: absolute;\n          top: -18px;\n          left: -18px;\n          border-radius: 50%;\n          width: 32px;\n          height: 32px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 14px;\n          font-weight: bold;\n          border: 3px solid #fffbe6;\n          box-shadow: 0 3px 10px rgba(0,0,0,0.18);\n          z-index: 30;\n          background: #ffe082;\n          color: #a67c1e;\n          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n          pointer-events: auto;\n        ">').concat(t,'</div>\n        <span style="\n          position: absolute;\n          left: 70%;\n          bottom: 6px;\n          font-size: 22px;\n          z-index: 20;\n          animation: person1-walk 3.8s linear infinite;\n          white-space: nowrap;\n        ">\uD83D\uDEB6\uD83C\uDFFD‍♂️</span>\n        <span style="\n          position: absolute;\n          left: 70%;\n          bottom: 6px;\n          font-size: 22px;\n          z-index: 20;\n          animation: person2-walk 3.8s linear infinite;\n          animation-delay: 1.9s;\n          white-space: nowrap;\n        ">\uD83D\uDEB6\uD83C\uDFFE‍♀️</span>\n      </div>\n    ');return t>=15?g.divIcon({html:d,className:"custom-cluster-icon",iconSize:[c.size,c.size]}):t>=10?g.divIcon({html:u,className:"custom-cluster-icon",iconSize:[c.size,c.size]}):g.divIcon({html:p,className:"custom-cluster-icon",iconSize:[c.size,c.size]})},children:t.map((e,t)=>{let r=e.ProjectCategory||"Other";return s(r),(0,o.jsx)(u.p,{riseOnHover:!0,position:[e.Latitude,e.Longitude],icon:h(r,!1,!1,e),eventHandlers:{mouseover:t=>{let n=t.target;if(i.current&&i.current!==n){let e=i.current.projectData,t=(null==e?void 0:e.ProjectCategory)||"Other";i.current.setIcon(h(t,!1,!1,e))}n.setIcon(h(r,!0,!1,e)),i.current=n,n&&n.openPopup&&n.openPopup()},mouseout:t=>{let n=t.target;n.setIcon(h(r,!1,!1,e)),i.current===n&&(i.current=null),n&&n.closePopup&&n.closePopup()},click:()=>{n&&n(e)}},ref:n=>{if(n){let o="".concat(e.Name,"-").concat(t);l.current[o]=n,n.options.projectData=e}},children:(0,o.jsx)(p.z,{closeButton:!0,autoPan:!0,maxWidth:300,riseOnHover:!0,children:(0,o.jsx)("div",{dangerouslySetInnerHTML:{__html:x(e)}})})},"".concat(e.Name,"-").concat(t))})}):null};var b=n(5683),v=n(9124);let y=e=>{let{isVisible:t,galleryItemRef:n,markerRef:a,mapRef:l,projectName:i,hoveredProject:s}=e,[c,d]=(0,r.useState)(null),[u,p]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{var e;if(!t){p(!1),d(null);return}if(!(null==n?void 0:n.current)||!(null==a?void 0:a.current)||!(null==l?void 0:l.current)){d(null);return}let o=()=>{try{let e=n.current.getBoundingClientRect();if(0===e.width||0===e.height){console.log("Gallery item not properly positioned yet");return}let t=e.left+e.width/2,o=e.top;a.current;let r=l.current,c=r._leaflet_map||r;if(!c){console.warn("Leaflet map instance not found");return}if(!c.getSize||!c.getSize().x){console.log("Map not fully initialized yet");return}let u=parseFloat(s.Latitude),f=parseFloat(s.Longitude);if(isNaN(u)||isNaN(f)){console.warn("Invalid coordinates:",s);return}let g=c.latLngToContainerPoint([u,f]),h=c.getContainer().getBoundingClientRect();if(0===h.width||0===h.height){console.log("Map container not properly positioned yet");return}let x=h.left+g.x,m=h.top+g.y;if(x<0||m<0||x>window.innerWidth||m>window.innerHeight){console.log("Marker coordinates outside viewport:",{markerX:x,markerY:m});return}console.log("Line coordinates calculated:",{gallery:{x:t,y:o},marker:{x:x,y:m},project:i}),d({x1:t,y1:o,x2:x,y2:m}),p(!0)}catch(e){console.error("Error calculating line coordinates:",e),d(null),p(!1)}},r=setTimeout(()=>{o()},50),c=(null===(e=l.current)||void 0===e?void 0:e._leaflet_map)||l.current;if(c){let e=()=>{setTimeout(o,10)};return c.on("zoom",e),c.on("move",e),()=>{clearTimeout(r),c.off("zoom",e),c.off("move",e)}}return()=>{clearTimeout(r)}},[t,n,a,l,i,s]),t&&u&&c)?(0,o.jsxs)("svg",{className:"connection-line visible",style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",pointerEvents:"none",zIndex:9999},children:[(0,o.jsx)("defs",{children:(0,o.jsx)("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:(0,o.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#3B82F6"})})}),(0,o.jsx)("line",{x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2,stroke:"#3B82F6",strokeWidth:"2",strokeDasharray:"5,5",markerEnd:"url(#arrowhead)",opacity:"0.8",children:(0,o.jsx)("animate",{attributeName:"stroke-dashoffset",values:"0;10",dur:"1s",repeatCount:"indefinite"})}),(0,o.jsx)("line",{x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2,stroke:"#3B82F6",strokeWidth:"4",opacity:"0.2"})]}):null},j=e=>{let{isOpen:t,onClose:n,projects:a,markerRefs:l,mapBounds:i,mapRef:s,onMarkerHover:c,onMarkerLeave:u,onMarkerClick:p}=e,[f,g]=(0,r.useState)(null),[x,m]=(0,r.useState)([]),[j,w]=(0,r.useState)(null),N=(0,r.useRef)({}),{isDarkMode:k,toggleDarkMode:C}=(0,d.D)();(0,r.useEffect)(()=>{if(!a){m([]);return}if(!i){m(a);return}let e=a.filter(e=>{let t=parseFloat(e.Latitude),n=parseFloat(e.Longitude);return!(isNaN(t)||isNaN(n))&&(i.contains?i.contains([t,n]):t>=i.south&&t<=i.north&&n>=i.west&&n<=i.east)});0===e.length&&a.length>0?m(a):m(e)},[a,i]);let L=e=>{if(j&&j.Name!==e.Name){let e=a.findIndex(e=>e.Name===j.Name&&parseFloat(e.Latitude)===parseFloat(j.Latitude)&&parseFloat(e.Longitude)===parseFloat(j.Longitude));if(-1!==e){let t="".concat(j.Name,"-").concat(e),n=null==l?void 0:l.current[t];if(n){let e=h(j.ProjectCategory||"Other",!1,!1,j);n.setIcon(e)}}}if(w(e),null==s?void 0:s.current){let t=s.current._leaflet_map||s.current;if(t){let n="".concat(e.Name,"-").concat(a.findIndex(t=>t.Name===e.Name&&parseFloat(t.Latitude)===parseFloat(e.Latitude)&&parseFloat(t.Longitude)===parseFloat(e.Longitude))),o=null==l?void 0:l.current[n];console.log("Gallery click - Current zoom level:",t.getZoom()),console.log("Gallery click - Marker found:",!!o);let r=o&&o.getElement&&o.getElement();if(console.log("Gallery click - Marker is individually visible:",r),r)console.log("Gallery click - Opening ProjectGalleryLayout for:",e.Name),p&&p(e);else{console.log("Gallery click - Flying to project:",e.Name);let n=parseFloat(e.Latitude),o=parseFloat(e.Longitude);isNaN(n)||isNaN(o)||(t.flyTo([n,o],13,{duration:1.5,easeLinearity:.25}),setTimeout(()=>{let t="".concat(e.Name,"-").concat(a.findIndex(t=>t.Name===e.Name&&parseFloat(t.Latitude)===parseFloat(e.Latitude)&&parseFloat(t.Longitude)===parseFloat(e.Longitude))),n=null==l?void 0:l.current[t];if(n&&n.openPopup){console.log("Gallery - Opening popup after flyTo for:",e.Name),n.openPopup();let t=h(e.ProjectCategory||"Other",!0,!1,e);n.setIcon(t)}},1600))}}}},F=(e,t)=>{g(e);let n=a.findIndex(t=>t.Name===e.Name&&parseFloat(t.Latitude)===parseFloat(e.Latitude)&&parseFloat(t.Longitude)===parseFloat(e.Longitude));if(-1!==n){let t="".concat(e.Name,"-").concat(n),o=null==l?void 0:l.current[t];if(o){let t=h(e.ProjectCategory||"Other",!0,!1,e);o.setIcon(t)}}c&&c(e)},S=e=>{g(null);let t=a.findIndex(t=>t.Name===e.Name&&parseFloat(t.Latitude)===parseFloat(e.Latitude)&&parseFloat(t.Longitude)===parseFloat(e.Longitude));if(-1!==t){let n="".concat(e.Name,"-").concat(t),o=null==l?void 0:l.current[n];if(o){let t=h(e.ProjectCategory||"Other",!1,!1,e);o.setIcon(t)}}u&&u(e)};return(0,o.jsx)(b.N,{children:t&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(v.P.div,{className:"fixed bottom-0 left-0 right-0 flex items-center",style:{zIndex:9998,height:"105px",background:"rgba(255,255,255,0.18)",borderTop:"1.5px solid rgba(255,255,255,0.35)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",boxShadow:"0 2px 16px rgba(0,0,0,0.12)",fontFamily:"sans-serif",color:k?"#fff":"#222"},initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:200,duration:.3},children:(0,o.jsx)("div",{className:"h-full px-4 py-2 w-full",children:(0,o.jsxs)("div",{className:"h-full flex gap-3 items-center",children:[(0,o.jsxs)("div",{className:"flex-shrink-0 flex flex-col justify-center items-center rounded-lg border",style:{background:"rgba(255,255,255,0.35)",border:"1px solid rgba(255,255,255,0.18)",boxShadow:"0 2px 8px rgba(0,0,0,0.10)",color:k?"#fff":"#222",fontFamily:"inherit",fontWeight:600,width:80,height:64,position:"relative"},children:[(0,o.jsx)("h3",{className:"text-xs font-semibold text-center leading-tight",style:{color:k?"#fff":"#222"},children:"Projects"}),x.length>0&&(0,o.jsx)("span",{className:"text-xs mt-1",style:{color:k?"#fff":"#222",opacity:.7},children:x.length}),(0,o.jsx)("button",{onClick:C,className:"absolute top-1 left-1 p-0.5 rounded-full transition-colors",style:{background:"rgba(255,255,255,0.18)",color:k?"#fff":"#222",border:"none",boxShadow:"0 1px 4px rgba(0,0,0,0.10)"},title:"Toggle dark mode",children:k?(0,o.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})}):(0,o.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,o.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})}),(0,o.jsx)("button",{onClick:n,className:"absolute top-1 right-1 p-0.5 rounded-full transition-colors",style:{background:"rgba(255,255,255,0.18)",color:k?"#fff":"#222",border:"none",boxShadow:"0 1px 4px rgba(0,0,0,0.10)"},title:"Close gallery",children:(0,o.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,o.jsx)("div",{style:{width:"100%",overflowX:"auto",minWidth:0},children:(0,o.jsx)("div",{className:"flex gap-3 h-full items-center gallery-scroll",style:{minWidth:"max-content",paddingRight:60},children:0===x.length?(0,o.jsx)("div",{className:"flex items-center justify-center",style:{color:k?"#fff":"#222",opacity:.7},children:(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,o.jsx)("span",{className:"text-sm",children:"No projects in view"})]})}):x.map((e,t)=>(0,o.jsx)(v.P.div,{ref:n=>{N.current["".concat(e.Name,"-").concat(t)]=n},className:"flex-shrink-0 cursor-pointer group",onClick:()=>L(e),onMouseEnter:()=>F(e,t),onMouseLeave:()=>S(e),whileHover:{scale:1.03,y:-2},transition:{type:"spring",stiffness:300,damping:20},layout:!0,children:(0,o.jsxs)("div",{className:"relative rounded-lg overflow-hidden border",style:{background:"rgba(255,255,255,0.35)",border:"1px solid rgba(255,255,255,0.18)",boxShadow:"0 2px 8px rgba(0,0,0,0.10)",color:k?"#fff":"#222",fontFamily:"inherit",fontWeight:600,width:80,height:64,position:"relative"},children:[(0,o.jsxs)("div",{className:"relative w-full h-full overflow-hidden",children:[(0,o.jsx)("img",{src:e.ImageUrl||"https://via.placeholder.com/80x64/4F46E5/FFFFFF?text=Project",alt:e.Name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",loading:"lazy"}),(0,o.jsx)(v.P.div,{className:"absolute inset-0",style:{background:"linear-gradient(to top, rgba(0,0,0,0.60), transparent 80%)",opacity:(null==f?void 0:f.Name)===e.Name?.6:0,transition:"opacity 0.2s"}}),(0,o.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-1",style:{background:"linear-gradient(to top, rgba(0,0,0,0.80), transparent 80%)"},children:(0,o.jsx)("h4",{className:"text-xs font-medium leading-tight",style:{color:"#fff",fontFamily:"inherit",fontWeight:600},children:e.Name})})]}),(null==f?void 0:f.Name)===e.Name&&(0,o.jsx)(v.P.div,{className:"absolute top-1 right-1 w-2 h-2 bg-blue-500 rounded-full shadow-lg",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500}})]})},"".concat(e.Name,"-").concat(t)))})})]})})}),(0,o.jsx)(y,{isVisible:!!f,galleryItemRef:(()=>{if(!f)return{current:null};let e=x.findIndex(e=>e.Name===f.Name&&parseFloat(e.Latitude)===parseFloat(f.Latitude)&&parseFloat(e.Longitude)===parseFloat(f.Longitude));if(-1===e)return{current:null};let t="".concat(f.Name,"-").concat(e);return{current:N.current[t]||null}})(),markerRef:(()=>{if(!f)return{current:null};let e=a.findIndex(e=>e.Name===f.Name&&parseFloat(e.Latitude)===parseFloat(f.Latitude)&&parseFloat(e.Longitude)===parseFloat(f.Longitude));if(-1===e)return{current:null};let t="".concat(f.Name,"-").concat(e);return(null==l?void 0:l.current[t])?{current:l.current[t]}:{current:null}})(),mapRef:s,projectName:null==f?void 0:f.Name,hoveredProject:f})]})})};var w=n(8617),N=n(9928),k=n(3467),C=n(2423),L=n(5765),F=n(5677),S=n(767),z=n(3518),P=n(6967),I=n(9191),D=n(1556);function E(e){let{poems:t,selectedPoem:n,setSelectedPoem:r,isAnimating:a,startAnimation:l,resetAnimation:i}=e,{isDarkMode:s}=(0,d.D)();return t&&0!==t.length?(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)("h3",{className:"font-semibold text-sm mb-3",style:{color:s?"#ffffff":"#111827"},children:"Select a Poem"}),(0,o.jsx)("div",{className:"grid gap-2",children:t.map((e,t)=>(0,o.jsxs)(v.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>r(t),className:"text-left p-3 rounded-lg transition-all duration-200",style:{backgroundColor:n===t?s?"rgba(30, 58, 138, 0.3)":"rgba(59, 130, 246, 0.1)":s?"rgba(31, 41, 55, 0.5)":"rgba(243, 244, 246, 0.8)",border:n===t?s?"1px solid rgba(59, 130, 246, 0.5)":"1px solid rgba(59, 130, 246, 0.3)":"1px solid transparent",color:n===t?s?"#ffffff":"#111827":s?"#d1d5db":"#6b7280","&:hover":{backgroundColor:n===t?s?"rgba(30, 58, 138, 0.3)":"rgba(59, 130, 246, 0.1)":s?"rgba(55, 65, 81, 0.5)":"rgba(229, 231, 235, 0.8)",color:s?"#ffffff":"#111827"}},children:[(0,o.jsx)("div",{className:"font-medium text-sm",children:e.Title}),(0,o.jsx)("div",{className:"text-xs mt-1",style:{color:s?"#9ca3af":"#6b7280"},children:e.Author}),e.location&&(0,o.jsx)("div",{className:"text-xs mt-1",style:{color:"#3b82f6"},children:e.location})]},t))})]}),(0,o.jsxs)("div",{className:"flex gap-2",children:[(0,o.jsxs)(v.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:l,disabled:a,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors",style:{backgroundColor:a?s?"#4b5563":"#9ca3af":"#3b82f6",color:"#ffffff","&:hover":{backgroundColor:a?s?"#4b5563":"#9ca3af":"#2563eb"}},children:[(0,o.jsx)(I.A,{className:"w-4 h-4"}),a?"Playing...":"Animate"]}),(0,o.jsxs)(v.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:i,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors",style:{backgroundColor:s?"#4b5563":"#6b7280",color:"#ffffff","&:hover":{backgroundColor:s?"#374151":"#4b5563"}},children:[(0,o.jsx)(D.A,{className:"w-4 h-4"}),"Reset"]})]})]}):(0,o.jsxs)("div",{className:"italic text-center py-8",style:{color:s?"#9ca3af":"#6b7280"},children:[(0,o.jsx)(k.A,{className:"w-8 h-8 mx-auto mb-2 opacity-60"}),"No poems available for this project."]})}function A(e){var t,n;let{poem:a,completedLines:l,currentLineIndex:i}=e,{isDarkMode:s}=(0,d.D)();if(!a)return null;let c=(null===(n=a.Content)||void 0===n?void 0:null===(t=n.split("\n"))||void 0===t?void 0:t.filter(e=>e.trim()))||[],u=e=>{let{text:t,isActive:n,isComplete:a,delay:l=0}=e,[i,c]=r.useState("");return(0,r.useEffect)(()=>{if(!n){a?c(t):c("");return}let e=0,o=setInterval(()=>{c(t.slice(0,e+1)),++e>=t.length&&clearInterval(o)},50+30*Math.random());return()=>clearInterval(o)},[n,t,a]),(0,o.jsxs)(v.P.div,{initial:{opacity:0,y:10},animate:{opacity:n||a?1:.3,y:n||a?0:10},transition:{duration:.5,delay:l},className:"leading-relaxed",style:{color:n?"#93c5fd":a?s?"#d1d5db":"#374151":s?"#6b7280":"#9ca3af"},children:[i,n&&i.length<t.length&&(0,o.jsx)(v.P.span,{animate:{opacity:[1,0]},transition:{duration:.8,repeat:1/0,repeatType:"reverse"},style:{color:"#60a5fa"},children:"|"})]})};return(0,o.jsx)(b.N,{mode:"wait",children:(0,o.jsxs)(v.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5},className:"space-y-4",children:[(0,o.jsxs)("div",{className:"border-l-4 pl-4 py-2",style:{borderColor:"#3b82f6"},children:[(0,o.jsx)(v.P.h2,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"text-xl font-bold mb-1",style:{color:s?"#ffffff":"#111827"},children:null==a?void 0:a.Title}),(null==a?void 0:a.Author)&&(0,o.jsxs)(v.P.p,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},className:"text-sm",style:{color:s?"#9ca3af":"#6b7280"},children:["by ",a.Author]}),(null==a?void 0:a.location)&&(0,o.jsxs)(v.P.p,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.6},className:"text-xs mt-1",style:{color:"#3b82f6"},children:["\uD83D\uDCCD ",a.location]})]}),(0,o.jsx)(v.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"rounded-lg p-6 border",style:{backgroundColor:s?"rgba(17, 24, 39, 0.5)":"rgba(249, 250, 251, 0.8)",borderColor:s?"rgba(55, 65, 81, 0.5)":"rgba(229, 231, 235, 0.8)"},children:(0,o.jsx)("div",{className:"space-y-3 text-base font-mono",children:c.map((e,t)=>(0,o.jsx)(u,{text:e,isActive:i===t,isComplete:l.includes(t),delay:.1*t},"".concat(a.Title,"-").concat(t)))})})]},a.Title)})}function M(e){var t,n,a,l,i,s,c,u;let{project:p,onClose:f}=e;console.log("ProjectGalleryLayout rendered with project:",null==p?void 0:p.Name);let[g,h]=(0,r.useState)(0),[x,m]=(0,r.useState)([]),[b,v]=(0,r.useState)(0),{isDarkMode:y}=(0,d.D)(),[j,I]=(0,r.useState)(0),[D,M]=(0,r.useState)(!1),[R,B]=(0,r.useState)([]),[O,T]=(0,r.useState)(-1),W=()=>{var e,t;if(!p.Poems||!p.Poems[j])return;let n=(null===(t=p.Poems[j].Content)||void 0===t?void 0:null===(e=t.split("\n"))||void 0===e?void 0:e.filter(e=>e.trim()))||[];M(!0),B([]),T(-1),n.forEach((e,t)=>{setTimeout(()=>{T(t),setTimeout(()=>{B(e=>[...e,t]),t===n.length-1&&(M(!1),T(-1))},2e3+50*e.length)},3e3*t)})},_=()=>{M(!1),B([]),T(-1)};if((0,r.useEffect)(()=>{if(!p)return;let e=[];p.ImageUrl&&e.push({src:p.ImageUrl,title:p.Name,type:"project"}),p.Artworks&&p.Artworks.length>0&&p.Artworks.forEach(t=>{t.ImageUrl&&e.push({src:t.ImageUrl,title:t.Title,type:"artwork",description:t.Description})}),m(e)},[p]),!p)return null;let H=[{label:"Overview",icon:w.A,content:"overview"},...p.HasArtwork&&(null===(t=p.Artworks)||void 0===t?void 0:t.length)>0?[{label:"Artworks",icon:N.A,content:"artworks",count:p.Artworks.length}]:[],...p.HasPoems&&(null===(n=p.Poems)||void 0===n?void 0:n.length)>0?[{label:"Poems",icon:k.A,content:"poems",count:p.Poems.length}]:[],...(null===(a=p.Activities)||void 0===a?void 0:a.length)>0?[{label:"Activities",icon:C.A,content:"activities",count:p.Activities.length}]:[],...(null===(l=p.relatedUrls)||void 0===l?void 0:l.length)>0?[{label:"Links",icon:L.A,content:"links",count:p.relatedUrls.length}]:[]],U=()=>(0,o.jsxs)("div",{className:"space-y-6",children:[p.ImageUrl&&(0,o.jsx)("div",{className:"mb-4 flex justify-center",children:(0,o.jsx)("img",{src:p.ImageUrl,alt:p.Name,className:"rounded-lg shadow-lg max-w-full max-h-56 object-contain border",style:{width:"100%",maxWidth:320,borderColor:y?"#374151":"#e5e7eb",backgroundColor:y?"#000000":"#ffffff"}})}),(p.DescriptionLong||p.DescriptionShort)&&(0,o.jsxs)("section",{children:[(0,o.jsx)("h3",{className:"text-lg font-bold mb-2",style:{color:y?"#ffffff":"#111827"},children:"Description"}),(0,o.jsx)("p",{className:"text-lg leading-relaxed",style:{color:y?"#d1d5db":"#374151"},children:p.DescriptionLong||p.DescriptionShort})]}),p.Background&&(0,o.jsxs)("section",{children:[(0,o.jsx)("h3",{className:"text-lg font-bold mb-2",style:{color:y?"#ffffff":"#111827"},children:"Background"}),(0,o.jsx)("p",{className:"text-lg leading-relaxed",style:{color:y?"#d1d5db":"#374151"},children:p.Background})]})]}),G=()=>{var e;return(0,o.jsx)("div",{className:"space-y-3",children:null===(e=p.Artworks)||void 0===e?void 0:e.map((e,t)=>(0,o.jsxs)("div",{className:"group flex items-start gap-3 p-2 rounded-lg cursor-pointer transition-colors",style:{backgroundColor:"transparent","&:hover":{backgroundColor:y?"#374151":"#f3f4f6"}},onClick:()=>v(t+(p.ImageUrl?1:0)),children:[e.ImageUrl&&(0,o.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,o.jsx)("img",{src:e.ImageUrl,alt:e.Title,className:"w-12 h-12 object-cover rounded"}),(0,o.jsx)("div",{className:"absolute inset-0 rounded transition-colors flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.2)"}},children:(0,o.jsx)(F.A,{className:"w-4 h-4 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]}),(0,o.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,o.jsx)("h4",{className:"text-base font-medium mb-1 break-words",style:{color:y?"#ffffff":"#111827"},children:e.Title}),(0,o.jsx)("p",{className:"text-sm leading-relaxed break-words whitespace-pre-line",style:{color:y?"#d1d5db":"#6b7280"},children:e.DescriptionLong||e.Description})]})]},t))})},Z=()=>(0,o.jsx)(E,{poems:p.Poems||[],selectedPoem:j,setSelectedPoem:e=>{I(e),_()},isAnimating:D,startAnimation:W,resetAnimation:_}),V=()=>{var e;return(0,o.jsx)("div",{className:"space-y-3",children:null===(e=p.Activities)||void 0===e?void 0:e.map((e,t)=>(0,o.jsxs)("div",{className:"p-3 rounded-lg",style:{backgroundColor:y?"#374151":"#f3f4f6"},children:[(0,o.jsx)("h4",{className:"font-medium text-sm mb-1",style:{color:y?"#ffffff":"#111827"},children:e.Title}),(0,o.jsx)("p",{className:"text-sm mb-2",style:{color:y?"#d1d5db":"#6b7280"},children:e.Description}),(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[e.Date&&(0,o.jsx)("span",{className:"text-xs",style:{color:y?"#9ca3af":"#6b7280"},children:e.Date}),e.Link&&(0,o.jsxs)("a",{href:e.Link,target:"_blank",rel:"noopener noreferrer",className:"text-xs flex items-center gap-1",style:{color:"#3b82f6","&:hover":{color:"#60a5fa"}},children:["Learn More ",(0,o.jsx)(L.A,{className:"w-3 h-3"})]})]})]},t))})},X=()=>{var e;return(0,o.jsx)("div",{className:"space-y-2",children:null===(e=p.relatedUrls)||void 0===e?void 0:e.map((e,t)=>(0,o.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 rounded-lg transition-colors text-sm",style:{color:y?"#d1d5db":"#6b7280","&:hover":{backgroundColor:y?"#374151":"#f3f4f6",color:y?"#ffffff":"#111827"}},children:[(0,o.jsx)(L.A,{className:"w-4 h-4"}),e.title]},t))})},Y=x[b]||x[0];return(0,o.jsxs)("div",{className:"h-screen w-screen grid grid-cols-[420px_1fr] fixed top-0 left-0 z-[2000]",style:{backgroundColor:y?"#111827":"#ffffff"},children:[(0,o.jsxs)("div",{className:"border-r flex flex-col min-w-0",style:{width:420,backgroundColor:y?"#111827":"#f9fafb",borderColor:y?"#374151":"#e5e7eb"},children:[(0,o.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",style:{borderColor:y?"#374151":"#e5e7eb"},children:[(0,o.jsx)("h1",{className:"font-bold text-2xl truncate pr-2",style:{color:y?"#ffffff":"#111827"},children:p.Name}),(0,o.jsx)("button",{onClick:f,className:"p-2 rounded-lg transition-colors",style:{color:y?"#9ca3af":"#6b7280","&:hover":{backgroundColor:y?"#374151":"#f3f4f6"}},children:(0,o.jsx)(S.A,{className:"w-6 h-6"})})]}),(0,o.jsx)("div",{className:"flex overflow-x-auto scrollbar-hide border-b",style:{borderColor:y?"#374151":"#e5e7eb"},children:H.map((e,t)=>{let n=e.icon;return(0,o.jsxs)("button",{onClick:()=>h(t),className:"flex items-center gap-2 px-4 py-3 text-base font-semibold border-b-2 transition-colors whitespace-nowrap",style:{color:g===t?"#3b82f6":y?"#d1d5db":"#6b7280",borderBottomColor:g===t?"#3b82f6":"transparent",backgroundColor:g===t?y?"#374151":"#f3f4f6":"transparent","&:hover":{color:g===t?"#3b82f6":"#60a5fa"}},children:[(0,o.jsx)(n,{className:"w-5 h-5"}),e.label,e.count&&(0,o.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full",style:{backgroundColor:y?"#4b5563":"#e5e7eb",color:y?"#d1d5db":"#374151"},children:e.count})]},e.label)})}),(0,o.jsx)("div",{className:"flex-1 overflow-y-auto p-6",style:{maxHeight:"calc(100vh - 112px)"},children:(null===(i=H[g])||void 0===i?void 0:i.content)==="poems"?Z():(()=>{var e;switch(null===(e=H[g])||void 0===e?void 0:e.content){case"overview":return U();case"artworks":return G();case"poems":return Z();case"activities":return V();case"links":return X();default:return null}})()})]}),(0,o.jsx)("div",{className:"flex items-center justify-center relative",style:{backgroundColor:y?"#000000":"#f9fafb"},children:(null===(s=H[g])||void 0===s?void 0:s.content)==="overview"?p.ImageUrl?(0,o.jsx)("img",{src:p.ImageUrl,alt:p.Name,className:"max-h-[70vh] max-w-full object-contain rounded-lg shadow-lg border",style:{width:"100%",maxWidth:600,borderColor:y?"#374151":"#e5e7eb",backgroundColor:y?"#000000":"#ffffff"}}):(0,o.jsxs)("div",{className:"text-center",style:{color:y?"#9ca3af":"#6b7280"},children:[(0,o.jsx)(N.A,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),(0,o.jsx)("p",{className:"text-sm",children:"No image available"})]}):(null===(c=H[g])||void 0===c?void 0:c.content)==="poems"?(0,o.jsx)("div",{className:"w-full h-full flex items-center justify-center",style:{minHeight:"60vh"},children:(0,o.jsx)("div",{className:"w-full max-w-2xl mx-auto p-8 rounded-2xl shadow-2xl border",style:{borderColor:y?"#1e3a8a":"#dbeafe",background:y?"linear-gradient(135deg, #181c24 0%, #1e2233 50%, #23293a 100%)":"linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f1f5f9 100%)",opacity:.9},children:(0,o.jsx)(A,{poem:null===(u=p.Poems)||void 0===u?void 0:u[j],completedLines:R,currentLineIndex:O})})}):Y?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("img",{src:Y.src,alt:Y.title,className:"max-h-full max-w-full object-contain"}),(0,o.jsx)("div",{className:"absolute top-4 right-4 backdrop-blur-sm rounded-lg px-2 py-1",style:{backgroundColor:y?"rgba(0, 0, 0, 0.5)":"rgba(255, 255, 255, 0.8)"},children:(0,o.jsxs)("span",{className:"text-xs",style:{color:y?"#ffffff":"#111827"},children:[b+1," / ",x.length]})}),x.length>1&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:()=>v((b-1+x.length)%x.length),className:"absolute left-4 top-1/2 -translate-y-1/2 backdrop-blur-sm p-2 rounded-lg transition-colors",style:{backgroundColor:y?"rgba(0, 0, 0, 0.5)":"rgba(255, 255, 255, 0.8)"},children:(0,o.jsx)(z.A,{className:"w-5 h-5",style:{color:y?"#ffffff":"#111827"}})}),(0,o.jsx)("button",{onClick:()=>v((b+1)%x.length),className:"absolute right-4 top-1/2 -translate-y-1/2 backdrop-blur-sm p-2 rounded-lg transition-colors",style:{backgroundColor:y?"rgba(0, 0, 0, 0.5)":"rgba(255, 255, 255, 0.8)"},children:(0,o.jsx)(P.A,{className:"w-5 h-5",style:{color:y?"#ffffff":"#111827"}})})]})]}):(0,o.jsxs)("div",{className:"text-center",style:{color:y?"#9ca3af":"#6b7280"},children:[(0,o.jsx)(N.A,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),(0,o.jsx)("p",{className:"text-sm",children:"No image available"})]})})]})}let R=e=>{let{isVisible:t,galleryItemRef:n,markerRef:o,mapRef:a,hoveredProject:l}=e,[i,s]=(0,r.useState)(null);return(0,r.useEffect)(()=>{var e;let r=null,i=null,c=()=>{r&&r.classList.remove("highlighted"),i&&i.classList.remove("highlighted")};if(!t||!(null==n?void 0:n.current)||!(null==a?void 0:a.current)||!l){c();return}let d=()=>{c();try{let e=a.current._leaflet_map||a.current;if(!e)return;let t=null==o?void 0:o.current;if(t&&t._icon)return;let n=parseFloat(l.Latitude),c=parseFloat(l.Longitude);if(isNaN(n)||isNaN(c))return;let d=e.latLngToContainerPoint([n,c]),u=e.getContainer().getBoundingClientRect(),p=u.left+d.x,f=u.top+d.y,g=document.querySelectorAll(".cluster-count-badge"),h=null,x=1/0;g.forEach(e=>{let t=e.getBoundingClientRect();if(0===t.width)return;let n=t.left+t.width/2,o=t.top+t.height/2,r=Math.sqrt(Math.pow(p-n,2)+Math.pow(f-o,2));r<x&&r<100&&(x=r,h=e)}),h&&((r=h).classList.add("highlighted"),(i=r.closest(".storybook-cluster, .desert-cluster, .border-cluster"))&&i.classList.add("highlighted"),s(r))}catch(e){console.error("Error in ClusterHighlighter:",e)}},u=setTimeout(d,50),p=(null===(e=a.current)||void 0===e?void 0:e._leaflet_map)||a.current;return p&&(p.on("zoomend",d),p.on("moveend",d)),()=>{clearTimeout(u),p&&(p.off("zoomend",d),p.off("moveend",d)),c()}},[t,n,o,a,l]),null},B=e=>{let{isOpen:t,onClose:n,projects:a=[],allProjects:l=[],markerRefs:i,mapBounds:c,mapRef:u,onMarkerHover:p,onMarkerLeave:f,onMarkerClick:g,style:x={},onDropdownProjectHover:m,justRestoredAt:y=0}=e,[j,w]=(0,r.useState)(null),[N,k]=(0,r.useState)([]),[C,L]=(0,r.useState)(null),[F,S]=(0,r.useState)("local"),z=(0,r.useRef)(null),P=(0,r.useRef)({}),{isDarkMode:I}=(0,d.D)(),[D,E]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!a){k([]);return}if(!c){k(a);return}let e=a.filter(e=>{let t=parseFloat(e.Latitude),n=parseFloat(e.Longitude);return!(isNaN(t)||isNaN(n))&&(c.contains?c.contains([t,n]):t>=c.south&&t<=c.north&&n>=c.west&&n<=c.east)});0===e.length&&a.length>0?k(a):k(e)},[a,c]);let A=()=>"all"===F?l:"local"===F?N:N.filter(e=>(e.ProjectCategory||"Other")===F),M=e=>{S(e)},B=e=>{g&&g(e)},O=(e,t)=>{let n=l.findIndex(t=>t.Name===e.Name&&parseFloat(t.Latitude)===parseFloat(e.Latitude)&&parseFloat(t.Longitude)===parseFloat(e.Longitude));if(-1!==n){let t="".concat(e.Name,"-").concat(n),o=null==i?void 0:i.current[t];if(o){let t=o.getElement&&o.getElement();t?w(null):w(e);let n=h(e.ProjectCategory||"Other",!0,!1,e);o.setIcon(n),t&&o.openPopup&&(console.log("Dropdown hover - Opening popup for:",e.Name),o.openPopup())}}p&&p(e),m&&m(e)},T=e=>{if(y&&Date.now()-y<300){console.log("[Dropdown] handleProjectLeave ignored due to justRestoredAt");return}console.log("[Dropdown] handleProjectLeave called for:",null==e?void 0:e.Name),w(null);let t=l.findIndex(t=>t.Name===e.Name&&parseFloat(t.Latitude)===parseFloat(e.Latitude)&&parseFloat(t.Longitude)===parseFloat(e.Longitude));if(-1!==t){let n="".concat(e.Name,"-").concat(t),o=null==i?void 0:i.current[n];if(o){let t=h(e.ProjectCategory||"Other",!1,!1,e);o.setIcon(t),o.getElement&&o.getElement()&&o.closePopup&&(console.log("Dropdown leave - Closing popup for:",e.Name),o.closePopup())}}f&&f(e),m&&m(null)};(0,r.useEffect)(()=>{let e=e=>{z.current&&!z.current.contains(e.target)&&n()};if(t)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[t,n]);let W=A();return(0,r.useEffect)(()=>{if(!N.length||!(null==u?void 0:u.current))return;let e=1/0,t=null;if(N.forEach(n=>{let o=parseFloat(n.Longitude);!isNaN(o)&&o<e&&(e=o,t=n)}),t){let e=u.current._leaflet_map||u.current,n=parseFloat(t.Latitude),o=parseFloat(t.Longitude);isNaN(n)||isNaN(o)||!e.latLngToContainerPoint||E(Math.max(e.latLngToContainerPoint([n,o]).x-40,8))}},[N,t,u]),(0,o.jsx)(b.N,{children:t&&(0,o.jsxs)(v.P.div,{ref:z,className:"fixed z-[9999] left-1/2 top-28 -translate-x-1/2 flex flex-col",style:{position:"absolute",top:80,left:null!==D?D:50,width:400,zIndex:2e3,borderRadius:14,background:"rgba(255,255,255,0.18)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",boxShadow:"0 2px 8px rgba(0,0,0,0.10)",border:"1.5px solid rgba(255,255,255,0.35)",color:I?"#fff":"#222",fontFamily:"sans-serif",fontSize:15,letterSpacing:"0.01em",padding:"18px",maxWidth:"100%",maxHeight:"70vh",overflow:"hidden",...x},initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{type:"spring",damping:25,stiffness:300,duration:.2},children:[(0,o.jsx)("button",{onClick:n,className:"absolute top-3 right-3 rounded-full w-8 h-8 flex items-center justify-center text-gray-500 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 shadow-md z-10",title:"Close dropdown",style:{fontWeight:700,fontSize:22,color:I?"#fff":"#222",background:"none",border:"none",boxShadow:"none"},children:"\xd7"}),(0,o.jsx)("div",{style:{display:"flex",gap:6,marginBottom:18,overflowX:"auto",background:"rgba(255,255,255,0.35)",borderRadius:10,padding:"6px 8px",boxShadow:"0 2px 8px rgba(0,0,0,0.10)",border:"1px solid rgba(255,255,255,0.18)",position:"relative",zIndex:2},children:["all","local",...[...new Set(l.map(e=>e.ProjectCategory||"Other"))].sort()].map(e=>{let t=s(e),n=F===e;return(0,o.jsxs)("button",{onClick:()=>M(e),style:{padding:"7px 14px",borderRadius:8,fontSize:13,fontWeight:n?700:500,background:n?"#fff":"rgba(255,255,255,0.18)",color:n?"#222":I?"#222":"#374151",border:n?"1.5px solid rgba(255,255,255,0.35)":"1.5px solid transparent",transition:"all 0.18s",display:"flex",alignItems:"center",gap:6,cursor:"pointer"},children:[t.icon&&(0,o.jsx)("span",{style:{fontSize:15},children:t.icon}),(0,o.jsx)("span",{style:{textTransform:"capitalize"},children:"all"===e?"All":"local"===e?"Local":e}),"local"===e&&(0,o.jsx)("span",{style:{fontSize:11,background:n?"rgba(0,0,0,0.07)":"rgba(255,255,255,0.28)",color:n?"#222":I?"#222":"#374151",borderRadius:6,padding:"1px 6px",marginLeft:4},children:N.length})]},e)})}),(0,o.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===W.length?(0,o.jsx)("div",{className:"flex items-center justify-center py-8 text-gray-500 dark:text-gray-400",children:(0,o.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,o.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,o.jsx)("span",{className:"text-sm",children:"No projects found"})]})}):(0,o.jsx)("div",{className:"grid grid-cols-3 gap-4",children:W.map((e,t)=>(0,o.jsx)(v.P.div,{ref:n=>{P.current["".concat(e.Name,"-").concat(t)]=n},className:"rounded-lg border hover:shadow-lg transition-all duration-200 cursor-pointer flex flex-col overflow-hidden group",style:{background:I?"rgba(0, 195, 255, 0.3)":"rgba(255, 140, 0, 0.82)",border:I?"1.5px solid rgba(255, 0, 0, 0.19)":"1.5px solid rgba(255,255,255,0.35)",color:I?"#fff":"#222",fontFamily:"inherit",fontWeight:500},onClick:()=>B(e),onMouseEnter:()=>O(e,t),onMouseLeave:()=>T(e),whileHover:{scale:1.03,y:-2},transition:{type:"spring",stiffness:300,damping:20},layout:!0,children:(0,o.jsxs)("div",{className:"relative w-full aspect-square overflow-hidden",children:[(0,o.jsx)("img",{src:e.ImageUrl||"https://via.placeholder.com/120x120/4F46E5/FFFFFF?text=Project",alt:e.Name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",loading:"lazy"}),(0,o.jsx)(v.P.div,{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-200",animate:{opacity:(null==j?void 0:j.Name)===e.Name?.6:0}}),(0,o.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/80 to-transparent",children:(0,o.jsx)("h4",{className:"text-white text-xs font-medium leading-tight",style:{fontFamily:"inherit",fontWeight:600},children:e.Name})}),(null==j?void 0:j.Name)===e.Name&&(0,o.jsx)(v.P.div,{className:"absolute top-2 right-2 w-2 h-2 bg-blue-500 rounded-full shadow-lg",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500}})]})},"".concat(e.Name,"-").concat(t)))})}),(0,o.jsx)(R,{isVisible:!!j,galleryItemRef:(()=>{if(!j)return{current:null};let e=A().findIndex(e=>e.Name===j.Name&&parseFloat(e.Latitude)===parseFloat(j.Latitude)&&parseFloat(e.Longitude)===parseFloat(j.Longitude));if(-1===e)return{current:null};let t="".concat(j.Name,"-").concat(e);return{current:P.current[t]||null}})(),markerRef:(()=>{if(!j)return{current:null};let e=l.findIndex(e=>e.Name===j.Name&&parseFloat(e.Latitude)===parseFloat(j.Latitude)&&parseFloat(e.Longitude)===parseFloat(j.Longitude));if(-1===e)return{current:null};let t="".concat(j.Name,"-").concat(e);return(null==i?void 0:i.current[t])?{current:i.current[t]}:{current:null}})(),mapRef:u,hoveredProject:j})]})})},O=e=>{let{activeCategory:t,filteredProjects:n,markerRefs:o,mapRef:a,isVisible:l=!1}=e,[i,s]=(0,r.useState)([]),{isDarkMode:c}=(0,d.D)();return(0,r.useEffect)(()=>{if(!l||!t||"all"===t||"local"===t){s([]);return}let e=n.filter(e=>(e.ProjectCategory||"Other")===t).map(e=>{let t=n.findIndex(t=>t.Name===e.Name&&parseFloat(t.Latitude)===parseFloat(e.Latitude)&&parseFloat(t.Longitude)===parseFloat(e.Longitude)),r="".concat(e.Name,"-").concat(t);return{project:e,markerRef:null==o?void 0:o.current[r],key:r}}).filter(e=>e.markerRef);return s(e),e.forEach(e=>{let{markerRef:t,project:n}=e;if(t){let e=h(n.ProjectCategory||"Other",!0,!1,n);t.setIcon(e)}}),()=>{e.forEach(e=>{let{markerRef:t,project:n}=e;if(t){let e=h(n.ProjectCategory||"Other",!1,!1,n);t.setIcon(e)}})}},[t,n,o,l]),null};function T(e){let{onSearch:t,searchTerm:n,setSearchTerm:a,filteredProjects:l=[],isInSidebar:i=!1,closeOnSelect:s=!0,onTabChange:c=null,onMenuClick:u=null,markerRefs:p=null,mapRef:f=null,mapBounds:g=null,onMarkerClick:x=null,isLayoutOpen:m=!1,showDropdown:b=!1,setShowDropdown:v=()=>{},justRestoredAt:y=0}=e,[j,w]=(0,r.useState)("all"),[N,k]=(0,r.useState)(null),[C,L]=(0,r.useState)(null),[F,S]=(0,r.useState)([]),[z,P]=(0,r.useState)(!1),[I,D]=(0,r.useState)({left:50,top:80}),E=(0,r.useRef)(null),{isDarkMode:A}=(0,d.D)(),M=()=>({left:50,top:80});(0,r.useEffect)(()=>{b&&D(M())},[b,f]),(0,r.useEffect)(()=>{if(!l){S([]);return}if(!g){S(l);return}if(z)return;let e=l.filter(e=>{let t=parseFloat(e.Latitude),n=parseFloat(e.Longitude);return!(isNaN(t)||isNaN(n))&&(g.contains?g.contains([t,n]):t>=g.south&&t<=g.north&&n>=g.west&&n<=g.east)});0===e.length&&l.length>0?S(l):S(e)},[l,g,z]);let R=()=>"all"===j?l:"local"===j?F:F.filter(e=>(e.ProjectCategory||"Other")===j);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("style",{children:"\n          .searchbar-input::placeholder {\n            color: #222;\n            opacity: 1;\n          }\n          body.dark-mode .searchbar-input::placeholder {\n            color: #fff;\n            opacity: 1;\n          }\n        "}),(0,o.jsx)("div",{style:{position:i?"relative":"absolute",top:i?"auto":20,left:i?"auto":I.left,zIndex:i?"auto":1e3,width:i?"100%":280},children:(0,o.jsxs)("div",{style:{width:"100%",background:"rgba(255,255,255,0.18)",borderRadius:14,boxShadow:"0 2px 8px rgba(0,0,0,0.10)",display:"flex",alignItems:"center",padding:"0 10px",minHeight:48,border:"1.5px solid rgba(255,255,255,0.35)",fontFamily:"sans-serif",color:A?"#fff":"#222",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},children:[u&&(0,o.jsx)("button",{onClick:u,style:{background:"transparent",border:"none",cursor:"pointer",padding:"8px",borderRadius:"8px",marginRight:"8px",color:A?"#fff":"#222",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(255,255,255,0.13)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},title:"Open sidebar",children:(0,o.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,o.jsx)("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),(0,o.jsx)("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),(0,o.jsx)("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),(0,o.jsx)("input",{ref:E,type:"text",placeholder:"Search...",value:n,onChange:e=>a(e.target.value),onFocus:()=>{v(!0),setTimeout(()=>{D(M())},100)},className:"searchbar-input",style:{border:"none",outline:"none",fontSize:17,width:"100%",background:"transparent",color:A?"#fff":"#222",padding:"12px 0",fontWeight:500,fontFamily:"inherit"}})]})}),(0,o.jsx)(O,{activeCategory:j,filteredProjects:l,markerRefs:p,mapRef:f,isVisible:b&&"all"!==j&&"local"!==j}),b&&!m&&(0,o.jsx)(B,{isOpen:b,onClose:()=>{v(!1)},projects:R?R():l,allProjects:l,markerRefs:p,mapBounds:g,mapRef:f,onMarkerHover:e=>{k(e);let t=l.findIndex(t=>t.Name===e.Name&&parseFloat(t.Latitude)===parseFloat(e.Latitude)&&parseFloat(t.Longitude)===parseFloat(e.Longitude));if(-1!==t){let n="".concat(e.Name,"-").concat(t),o=null==p?void 0:p.current[n];if(o){let t=h(e.ProjectCategory||"Other",!0,!1,e);o.setIcon(t),o.getElement&&o.getElement()&&(console.log("SearchBar hover - Opening popup for:",e.Name),o.openPopup())}}},onMarkerLeave:e=>{if(y&&Date.now()-y<300){console.log("[SearchBar] handleProjectLeave ignored due to justRestoredAt");return}console.log("[SearchBar] handleProjectLeave called for:",null==e?void 0:e.Name),k(null);let t=l.findIndex(t=>t.Name===e.Name&&parseFloat(t.Latitude)===parseFloat(e.Latitude)&&parseFloat(t.Longitude)===parseFloat(e.Longitude));if(-1!==t){let n="".concat(e.Name,"-").concat(t),o=null==p?void 0:p.current[n];if(o){let t=h(e.ProjectCategory||"Other",!1,!1,e);o.setIcon(t),o.getElement&&o.getElement()&&(console.log("SearchBar leave - Closing popup for:",e.Name),o.closePopup())}}},onMarkerClick:e=>{if(null==f?void 0:f.current){let t=f.current._leaflet_map||f.current;if(t){let n=l.findIndex(t=>t.Name===e.Name&&parseFloat(t.Latitude)===parseFloat(e.Latitude)&&parseFloat(t.Longitude)===parseFloat(e.Longitude));if(-1!==n){let o="".concat(e.Name,"-").concat(n),r=null==p?void 0:p.current[o];if(r&&r.getElement&&r.getElement())x&&x(e);else{let n=parseFloat(e.Latitude),r=parseFloat(e.Longitude);isNaN(n)||isNaN(r)||(P(!0),t.flyTo([n,r-.05],12,{duration:1.5,easeLinearity:.25}),setTimeout(()=>{P(!1);let t=null==p?void 0:p.current[o];if(t&&t.openPopup){t.openPopup();let n=h(e.ProjectCategory||"Other",!0,!1,e);t.setIcon(n)}},1600))}}}}},style:{top:I.top,left:I.left,width:400,borderRadius:16,boxShadow:A?"0 8px 32px rgba(0, 21, 255, 0.21)":"0 8px 32px rgb(248, 2, 227)"},justRestored:y})]})}let W=["Research Projects","Art-Based Projects","Education and Community Outreach","Research"],_=()=>{let[e,t]=(0,r.useState)(!1);return(0,o.jsxs)("div",{style:{position:"fixed",top:150,right:0,zIndex:1e3,display:"flex",alignItems:"flex-start",height:"auto",pointerEvents:"none",transform:e?"translateX(0)":"translateX(".concat(220,"px)"),transition:"transform 0.5s cubic-bezier(.77,0,.18,1)"},children:[(0,o.jsx)("button",{onClick:()=>t(e=>!e),style:{pointerEvents:"auto",width:36,height:80,borderRadius:"14px 0 0 14px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.44)",borderRight:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.10)",color:"#fff",fontFamily:"Cinzel, serif",fontWeight:700,fontSize:14,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",marginRight:1,zIndex:1001,transition:"background 0.2s, color 0.2s",position:"relative",top:14,letterSpacing:"0.05em",padding:0,writingMode:"vertical-rl",textOrientation:"mixed",textShadow:"0px 0px 3px rgba(0,0,0,0.9), 0px 0px 8px rgba(0,0,0,0.7)"},title:e?"Hide legend":"Show legend",children:(0,o.jsx)("span",{style:{fontWeight:700,fontFamily:"Cinzel, serif",fontSize:16,letterSpacing:"0.05em",userSelect:"none",color:"#fff",textShadow:"0px 0px 3px rgba(0,0,0,0.9), 0px 0px 8px rgba(0,0,0,0.7)"},children:e?"Close":"Legend"})}),(0,o.jsxs)("div",{style:{width:220,maxWidth:220,minWidth:220,background:"rgba(255,255,255,0.18)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",padding:"12px 16px",borderRadius:"14px 0 0 14px",boxShadow:"0 2px 8px rgba(0,0,0,0.10)",fontFamily:"sans-serif",color:"#222",border:"1.5px solid rgba(255,255,255,0.35)",borderRight:"none",textAlign:"left",fontSize:"13px",letterSpacing:"0.01em",marginLeft:-2,pointerEvents:e?"auto":"none",opacity:e?1:.7,position:"relative",transition:"opacity 0.2s"},children:[(0,o.jsx)("div",{style:{fontFamily:"'Cinzel', serif",fontWeight:700,fontSize:"28px",color:"#fff",textShadow:"0px 0px 3px rgba(0,0,0,0.9), 0px 0px 8px rgba(0,0,0,0.7)",letterSpacing:"0.05em",textAlign:"center",margin:"0 0 6px 0",padding:0},children:"Legend"}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"5px",textAlign:"left",padding:0},children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,o.jsx)("span",{style:{fontSize:"18px",marginRight:6},children:"\uD83D\uDCD6"}),(0,o.jsx)("span",{children:"Large Cluster"})]}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,o.jsx)("span",{style:{fontSize:"18px",marginRight:6},children:"\uD83C\uDF35"}),(0,o.jsx)("span",{children:"Medium Cluster"})]}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,o.jsx)("span",{style:{fontSize:"18px",marginRight:6},children:"\uD83D\uDEB6‍♂️\uD83D\uDEB6‍♀️"}),(0,o.jsx)("span",{children:"Small Cluster"})]}),(0,o.jsx)("div",{style:{height:1,background:"rgba(0,0,0,0.07)",margin:"5px 0"}}),W.map(e=>{let t=i[e];return(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,o.jsx)("span",{style:{fontSize:"18px",marginRight:6},children:t.icon}),(0,o.jsx)("span",{style:{color:t.color},children:t.label})]},e)})]})]})]})},H=()=>(0,o.jsxs)("div",{style:{position:"absolute",top:"25px",right:"25px",zIndex:1e3,textAlign:"right",pointerEvents:"none"},children:[(0,o.jsx)("h1",{style:{fontFamily:"'Cinzel', serif",margin:"0",fontSize:"38px",fontWeight:"700",color:"#ffffff",textShadow:"0px 0px 3px rgba(0, 0, 0, 0.9), 0px 0px 8px rgba(0, 0, 0, 0.7)",letterSpacing:"0.05em"},children:"El ChisMapa"}),(0,o.jsx)("p",{style:{fontFamily:"'Roboto', sans-serif",margin:"0",fontSize:"15px",fontStyle:"italic",color:"#ffffff",textShadow:"0px 0px 3px rgba(0, 0, 0, 0.9), 0px 0px 6px rgba(0, 0, 0, 0.7)",lineHeight:"1.3",maxWidth:"280px",float:"right"},children:"A living map of borderlands stories, projects, and connections."})]});var U=n(6756),G=n(8819);function Z(){let[e,t]=(0,r.useState)(null);(0,U.ko)();let n=g.canvas();return((0,r.useEffect)(()=>{fetch("/export (8).geojson").then(e=>e.json()).then(t)},[]),e)?(0,o.jsx)(G.k,{data:e,renderer:n,style:{color:"white",weight:5,fillOpacity:.5,opacity:.5}}):null}function V(){var e;let[t,n]=(0,r.useState)(null),a=(0,U.ko)(),[l,i]=(0,r.useState)(a.getZoom());if((0,r.useEffect)(()=>{fetch("/export (7).geojson").then(e=>e.json()).then(n)},[]),(0,r.useEffect)(()=>{let e=()=>i(a.getZoom());return a.on("zoomend",e),()=>a.off("zoomend",e)},[a]),!t)return null;let s=(e=t.features,l<8?e.filter(e=>{let t=(e.properties.place||"").toLowerCase(),n=parseInt(e.properties.population,10);return("city"===t||"town"===t)&&n&&n>5e5}):l<10?e.filter(e=>{let t=(e.properties.place||"").toLowerCase(),n=parseInt(e.properties.population,10);return("city"===t||"town"===t)&&n&&n>3e5}):l<12?e.filter(e=>{let t=(e.properties.place||"").toLowerCase(),n=parseInt(e.properties.population,10);return("city"===t||"town"===t)&&n&&n>2e4}):e.filter(e=>{let t=(e.properties.place||"").toLowerCase();return"city"===t||"town"===t})),c={...t,features:s};return console.log("[TownsLabelLayer] zoom:",l,"visible features:",s.length,"names:",s.map(e=>e.properties.name)),(0,o.jsx)(G.k,{data:c,pointToLayer:(e,t)=>{let n=e.properties.name||"Unknown",o=Math.max(40,8*n.length);return g.marker(t,{icon:g.divIcon({className:"map-town-label",html:'<span style="'.concat("\n    color: #222;\n    font-size: 15px;\n    font-family: 'Inter', 'Segoe UI', Arial, sans-serif;\n    font-weight: 500;\n    text-align: center;\n    white-space: nowrap;\n    pointer-events: none;\n    text-shadow: 0 1px 4px rgba(255,255,255,0.7), 0 0px 2px rgba(0,0,0,0.18);\n    background: none;\n    border: none;\n    padding: 0;\n    margin: 0;\n  ",'">').concat(n,"</span>"),iconSize:[o,20],iconAnchor:[o/2,10]}),interactive:!1,keyboard:!1})}},l)}let X=[31.333699,-111.250821],Y=[[23.5,-118.5],[38.5,-101.5]];function q(){let{projects:e,loading:t,error:n}=function(){let[e,t]=(0,r.useState)([]),[n,o]=(0,r.useState)(""),[a,l]=(0,r.useState)([]),[i,s]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("storymapdata_db_ready_v2.json");if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let n=await e.json();t(n);let o=[...new Set(n.map(e=>e.ProjectCategory).filter(Boolean))];console.log("Found categories in data:",o);let r=c(n);console.log("Processed categories:",r),l(r)}catch(e){console.error("Error fetching data:",e),s(e.message)}})()},[]);let d=(0,r.useMemo)(()=>n?e.filter(e=>e.ProjectCategory===n):e,[e,n]),u=(0,r.useCallback)(e=>{o(e)},[]),p=(0,r.useCallback)(()=>e.filter(e=>e.Artworks&&e.Artworks.length>0),[e]),f=(0,r.useCallback)(()=>e.filter(e=>e.Poems&&e.Poems.length>0),[e]),g=(0,r.useCallback)(()=>{let t=new Set;return e.forEach(e=>{e.Activities&&e.Activities.forEach(e=>{t.add(e)})}),Array.from(t)},[e]);return{projects:e,filteredProjects:d,categories:a,error:i,filterProjects:u,getProjectsWithArtworks:p,getProjectsWithPoems:f,getUniqueActivities:g}}(),{isDarkMode:i}=(0,d.D)(),[s,u]=(0,r.useState)(!1),[p,f]=(0,r.useState)(null),[g,x]=(0,r.useState)(null),[b,v]=(0,r.useState)(!1),[y,w]=(0,r.useState)(""),[N,k]=(0,r.useState)([]),C=(0,r.useRef)({}),L=(0,r.useRef)(null),[F,S]=(0,r.useState)(!0),[z,P]=(0,r.useState)(!1),[I,D]=(0,r.useState)(null),[E,A]=(0,r.useState)(0);(0,r.useEffect)(()=>{if(L.current){let e=L.current._leaflet_map||L.current;if(e){let t=()=>{f(e.getBounds())};return e.on("moveend",t),e.on("zoomend",t),t(),()=>{e.off("moveend",t),e.off("zoomend",t)}}}},[L.current]),(0,r.useEffect)(()=>{if(!e){k([]);return}if(!y.trim()){k(e);return}k(e.filter(e=>{var t,n,o,r;let a=y.toLowerCase();return(null===(t=e.Name)||void 0===t?void 0:t.toLowerCase().includes(a))||(null===(n=e.DescriptionShort)||void 0===n?void 0:n.toLowerCase().includes(a))||(null===(o=e.ProjectCategory)||void 0===o?void 0:o.toLowerCase().includes(a))||(null===(r=e.Description)||void 0===r?void 0:r.toLowerCase().includes(a))}))},[e,y]);let R=t=>{if(console.log("handleMarkerClick called for:",t.Name),null==L?void 0:L.current){let n=L.current._leaflet_map||L.current;if(n){let o="".concat(t.Name,"-").concat(e.findIndex(e=>e.Name===t.Name&&parseFloat(e.Latitude)===parseFloat(t.Latitude)&&parseFloat(e.Longitude)===parseFloat(t.Longitude))),r=C.current[o];console.log("Current zoom level:",n.getZoom()),console.log("Marker found:",!!r);let a=r&&r.getElement&&r.getElement();console.log("Marker is individually visible:",a),a&&(console.log("Opening ProjectGalleryLayout for:",t.Name),D(t),x(t),v(!0))}else console.log("Map not found")}else console.log("mapRef not available")},B=e=>{if(console.log("[Map.js] handleDropdownProjectHover called with:",null==e?void 0:e.Name),D(e),!e)return;let t="".concat(e.Name,"-").concat(N.findIndex(t=>t.Name===e.Name&&parseFloat(t.Latitude)===parseFloat(e.Latitude)&&parseFloat(t.Longitude)===parseFloat(e.Longitude))),n=C.current[t];if(n){let t=h(e.ProjectCategory||"Other",!0,!1,e);n.setIcon(t),n.getElement&&n.getElement()&&n.openPopup&&n.openPopup()}};(0,r.useEffect)(()=>{F&&I&&B(I)},[F,I]);let O=(0,r.useMemo)(()=>e?y.trim()?e.filter(e=>{var t,n,o,r;let a=y.toLowerCase();return(null===(t=e.Name)||void 0===t?void 0:t.toLowerCase().includes(a))||(null===(n=e.DescriptionShort)||void 0===n?void 0:n.toLowerCase().includes(a))||(null===(o=e.ProjectCategory)||void 0===o?void 0:o.toLowerCase().includes(a))||(null===(r=e.Description)||void 0===r?void 0:r.toLowerCase().includes(a))}):e:[],[e,y]);return t?(0,o.jsx)("div",{children:"Loading map..."}):n?(0,o.jsxs)("div",{children:["Error loading map: ",n]}):(0,o.jsxs)("div",{style:{position:"relative",height:"100vh",width:"100%"},children:[(0,o.jsxs)(a.W,{ref:L,center:X,zoom:7,style:{height:"100vh",width:"100%"},maxBounds:Y,bounds:Y,minZoom:6,maxZoom:17,children:[(0,o.jsx)(l.e,{url:i?"https://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}":"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors \xa9 <a href="https://carto.com/attributions">CARTO</a>',minZoom:0,maxZoom:16}),(0,o.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:400,background:"linear-gradient(180deg, rgba(0, 255, 234, 0.19) 0%, rgba(0, 8, 255, 0.13) 100%)"}}),(0,o.jsx)(m,{projects:O,markerRefs:C,onMarkerClick:R}),(0,o.jsx)(Z,{}),(0,o.jsx)(V,{})]}),(0,o.jsx)(H,{}),(0,o.jsx)(_,{}),(0,o.jsx)("div",{className:"absolute top-0 left-0 w-full z-[1000] p-4 pointer-events-none",children:(0,o.jsx)("div",{className:"w-full max-w-lg mx-auto pointer-events-auto",children:(0,o.jsx)(T,{onSearch:e=>{w(e)},searchTerm:y,setSearchTerm:w,filteredProjects:O,markerRefs:C,mapRef:L,mapBounds:p,onMarkerClick:R,isLayoutOpen:b,showDropdown:F,setShowDropdown:S,onDropdownProjectHover:B,justRestoredAt:E})})}),(0,o.jsx)("button",{onClick:()=>{console.log("Gallery toggle clicked, current state:",s),b&&(v(!1),x(null)),u(!s),console.log("New gallery state:",!s)},className:"z-[9999] rounded-lg",style:{position:"absolute",left:16,bottom:s&&!b?105:16,background:"rgba(255,255,255,0.18)",border:"1.5px solid rgba(255,255,255,0.35)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",boxShadow:"0 2px 16px rgba(0,0,0,0.12)",color:i?"#fff":"#222",fontFamily:"sans-serif",padding:14,transition:"box-shadow 0.2s, bottom 0.3s"},title:"Toggle Project Gallery",children:(0,o.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:i?"#fff":"#222"},children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),s&&!b&&(0,o.jsx)(j,{isOpen:s,onClose:()=>{u(!1)},projects:O,markerRefs:C,mapBounds:p,mapRef:L,onMarkerHover:t=>{console.log("Marker hovered:",t.Name);let n="".concat(t.Name,"-").concat(e.findIndex(e=>e.Name===t.Name&&parseFloat(e.Latitude)===parseFloat(t.Latitude)&&parseFloat(e.Longitude)===parseFloat(t.Longitude))),o=C.current[n];o&&o.openPopup&&(console.log("Opening popup for:",t.Name),o.openPopup())},onMarkerLeave:t=>{console.log("Marker left:",t.Name);let n="".concat(t.Name,"-").concat(e.findIndex(e=>e.Name===t.Name&&parseFloat(e.Latitude)===parseFloat(t.Latitude)&&parseFloat(e.Longitude)===parseFloat(t.Longitude))),o=C.current[n];o&&o.closePopup&&(console.log("Closing popup for:",t.Name),o.closePopup())},onMarkerClick:R,justRestoredAt:E}),g&&(0,o.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:99999,pointerEvents:"auto"},children:(0,o.jsx)(M,{project:g,onClose:()=>{console.log("[Map.js] handleProjectLayoutClose called"),console.log("[Map.js] showDropdown:",F,"lastDropdownHoveredProject:",null==I?void 0:I.Name),v(!1),x(null),F&&I&&(A(Date.now()),setTimeout(()=>{console.log("[Map.js] Delayed restoration of marker highlight and popup for:",I.Name),B(I)},300))}})}),console.log("Map render - selectedProject:",null==g?void 0:g.Name,"isProjectLayoutOpen:",b)]})}},9388:(e,t,n)=>{n.d(t,{D:()=>i,DarkModeProvider:()=>l});var o=n(5155),r=n(2115);let a=(0,r.createContext)();function l(e){let{children:t}=e,[n,l]=(0,r.useState)(!0);return(0,o.jsx)(a.Provider,{value:{isDarkMode:n,toggleDarkMode:()=>l(e=>!e)},children:t})}function i(){return(0,r.useContext)(a)}}}]);